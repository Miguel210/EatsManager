import{u as k}from"./useQuery-w5Ei2Yfx.js";import{s as oe,u as C,a as ae,c as ne,b as p,d as re}from"./vee-validate-Cs0uyyLT.js";import{d as se,l as le,D as ie,x as D,i as de,u as ue,c as d,a as o,n as w,I as $,F as O,g as F,K as T,t as i,o as u,v as U}from"./index-CozHna6C.js";import{e as b}from"./index-HRYNUPNB.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-BosuxZz1.js";const me=async e=>{try{const{data:t}=await b.post("/table/getorders/",{id:e});return console.log(t),{...t}}catch(t){throw console.log(t),new Error("Error getting data")}},pe=async()=>{try{const{data:e}=await b.get("/utils/productOrder");return console.log(e),{...e}}catch(e){throw console.log(e),new Error("Error getting data")}},be=async e=>{console.log(e);const t=e.id;return e.id&&e.id!==""?await ve(t,e):await ge(e)},ve=async(e,t)=>{delete t.id;try{const{data:c}=await b.post("/table/clientOrder/",{id:e,clientOrder:t});return c}catch(c){throw console.log(c),new Error("Uploading clientOrder")}},ge=async e=>{try{const{data:t}=await b.post("/table/clientOrder/",{clientOrder:e});return t}catch(t){throw console.log(t),new Error("Error creating clientOrder")}},ye=async e=>{console.log(e);try{const{data:t}=await b.post("/table/PayClientOrder/",{clientOrder:e});return t}catch(t){throw console.log(t),new Error("Error creating clientOrder")}},fe=async e=>{console.log(e);try{const{data:t}=await b.post("/table/finalizateClientOrder/",{clientOrder:e});return t}catch(t){throw console.log(t),new Error("Error creating clientOrder")}},we=ne({description:p(),status:p(),isActive:re(),clientOrder:p(),Movement:p(),MovementDetail:p(),Product:p()}),he=se({components:{InputText:oe},props:{tableId:{type:String,requerid:!0}},setup(e){const t=le({product:null,quantity:1}),c=ue(),{data:v,isError:S,isLoading:E}=k({queryKey:["tableCLientOrderForm",e.tableId],queryFn:()=>me(e.tableId)}),{isPending:a,isSuccess:m,data:y,mutate:r}=C({mutationFn:be}),{mutate:h}=C({mutationFn:ye}),{mutate:V}=C({mutationFn:fe}),{values:N,defineField:g,errors:q,handleSubmit:P,resetForm:I,meta:x}=ae({validationSchema:we}),[z,G]=g("data.description"),[A,Q]=g("data.status"),[M,L]=g("data.isActive"),[l,J]=g("data.clientOrder"),[B,K]=g("data.clientOrder.movement.movementDetail"),{data:R}=k({queryKey:["ProductOrder"],queryFn:()=>pe(),retry:!1}),j=P(async n=>{r(n)}),H=P(async n=>{h(n)}),W=P(async n=>{V(n)});ie(()=>{if(S.value&&!E.value){c.replace("/producto");return}}),D(v,()=>{v&&I({values:v.value})},{deep:!0,immediate:!0}),D(m,n=>{console.log("isUpdateSuccess"),n&&I({values:y.value})});const X=n=>{l.value[n].status="Pagado",l.value[n].movement.status="Pagado",H(l.value[n])},_=n=>l.value[n]?l.value[n].movement.movementDetail.reduce((f,te)=>Number(f)+Number(te.subTotal),""):0,Y=()=>(console.log(l.value),l.value.reduce((n,s)=>Number(n)+Number(_(s)),0)),Z=()=>{l.value.forEach(n=>{n.isPaid=!0})},ee=de(()=>l.value.every(n=>n.status==="Pagado"));return{values:N,errors:q,meta:x,isPending:a,table:v,description:z,descriptionAttrs:G,status:A,statusAttrs:Q,isActive:M,isActiveAttrs:L,clientOrder:l,clientOrderAttrs:J,productId:B,productIdAttrs:K,ProductOrder:R,paymentType:"individual",guests:[],addGuest(){l.value.push({id:"",paymentDate:new Date,tableId:e.tableId,status:"Pendiente",invoiceFolio:"",movement:{isCreate:!0,person:{fullname:""},documentId:"4a00ff37-2f05-4042-abcd-62270aaa31bb",elaborateId:"",personId:"CODESECRET-",movementDetail:[],amount:"0",status:"Pendiente"},showPanel:!0,isPaid:!1,newProduct:{product:{id:"",description:"",price:0}},newQuantity:1,nameInput:""})},addProduct:n=>{const s=l.value[n];console.log(s.movement.newProduct);const f={movementId:s.movement.id,isCreatemov:!0,quantity:s.movement.newQuantity,product:s.movement.newProduct,productId:s.movement.newProduct.id,priceUnit:s.movement.newProduct.price,costUnit:s.movement.newProduct.price,subTotal:s.movement.newQuantity*parseFloat(s.movement.newProduct.price),tax:0,total:s.movement.newQuantity*parseFloat(s.movement.newProduct.price)};console.log(f),s.movement.movementDetail.push(f),s.movement.personId==="CODESECRET-"&&(s.movement.personId+=s.movement.person.fullname),t.product=null,t.quantity=1},newProduct:t,allPaid:ee,payForGuest:X,calculateTotal:_,calculateTotalAll:Y,payTogether:Z,fianlizateSubmit:()=>{console.log("Venta finalizada"),A.value="Disponible/Vacia",W()},onSubmit:j}}}),Pe={class:"container mx-auto py-8"},Ce={class:"flex items-center mb-6"},Oe={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},Fe={class:"flex justify-between items-center"},Se=["onUpdate:modelValue","disabled"],Ee=["onClick","disabled"],Ie={class:"mt-4"},Ae={class:"mb-4 overflow-y-scroll h-24"},_e={class:"flex items-center mt-2"},ke=["onUpdate:modelValue","disabled"],De=["value"],$e=["onUpdate:modelValue","disabled"],Te=["onClick","disabled"],Ue={class:"mt-4"},Ve={class:"text-lg font-semibold text-gray-700 mb-2"},Ne={key:0,class:"mt-6"},qe={class:"mt-6"},xe={class:"text-lg font-semibold text-gray-700 mb-2"},ze={class:"mt-6"},Ge={class:"grid grid-cols-2"},Qe={class:"bg-blue-200"},Me={class:"bg-red-200"},Le={class:"bg-green-200 col-span-2"};function Je(e,t,c,v,S,E){return u(),d("form",null,[o("div",Pe,[t[8]||(t[8]=o("h1",{class:"text-2xl font-bold text-gray-800 mb-6"},"GestiÃ³n de Comensales",-1)),o("button",{onClick:t[0]||(t[0]=(...a)=>e.addGuest&&e.addGuest(...a)),type:"button",class:"mb-6 bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600"}," Agregar Comensal "),o("div",Ce,[t[6]||(t[6]=o("label",{class:"mr-4 font-semibold text-gray-700"},"Forma de pago:",-1)),w(o("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>e.paymentType=a),class:"border rounded p-2"},t[5]||(t[5]=[o("option",{value:"individual"},"Individual",-1),o("option",{value:"together"},"Junto",-1)]),512),[[$,e.paymentType]])]),o("div",Oe,[(u(!0),d(O,null,F(e.clientOrder,(a,m)=>{var y;return u(),d("div",{key:m,class:"bg-white shadow-md rounded-lg p-4"},[o("div",Fe,[w(o("input",{type:"text","onUpdate:modelValue":r=>a.movement.person.fullname=r,placeholder:"Nombre del comensal",class:"border-b border-gray-300 focus:outline-none focus:border-blue-500",disabled:a.isPaid},null,8,Se),[[U,a.movement.person.fullname]]),o("button",{type:"button",onClick:r=>e.payForGuest(m),disabled:a.status==="Pagado",class:"ml-4 bg-green-500 text-white py-1 px-3 rounded hover:bg-green-600 disabled:bg-gray-400 disabled:cursor-not-allowed"},i(a.status?"Pagado":"Pagar"),9,Ee)]),o("div",Ie,[t[7]||(t[7]=o("h3",{class:"text-lg font-semibold text-gray-700 mb-2"},"Productos",-1)),o("ul",Ae,[(u(!0),d(O,null,F(a.movement.movementDetail,(r,h)=>(u(),d("li",{key:h,class:"flex justify-between items-center mb-2"},[o("span",null,i(r.product.description)+" - $"+i(r.product.price)+" x "+i(r.quantity)+" = $"+i(r.total),1)]))),128))]),o("div",_e,[w(o("select",{"onUpdate:modelValue":r=>a.movement.newProduct=r,class:"border rounded p-2 mr-2",disabled:a.movement.person.fullname===""||a.status==="Pagado"},[(u(!0),d(O,null,F((y=e.ProductOrder)==null?void 0:y.data,r=>(u(),d("option",{key:r.id,value:r},i(r==null?void 0:r.description)+" - $"+i(r.price),9,De))),128))],8,ke),[[$,a.movement.newProduct]]),w(o("input",{"onUpdate:modelValue":r=>a.movement.newQuantity=r,type:"number",class:"border rounded p-2 w-16 mr-2",placeholder:"Cantidad",disabled:a.movement.person.fullname===""||a.status==="Pagado"},null,8,$e),[[U,a.movement.newQuantity]]),o("button",{onClick:r=>e.addProduct(m),type:"button",class:"bg-blue-500 text-white py-1 px-3 rounded hover:bg-blue-600",disabled:a.movement.person.fullname===""||a.status==="Pagado"}," Agregar Producto ",8,Te)])]),o("div",Ue,[o("h3",Ve,"Total: $"+i(e.calculateTotal(m)),1)])])}),128))]),e.paymentType==="together"?(u(),d("div",Ne,[o("button",{onClick:t[2]||(t[2]=(...a)=>e.payTogether&&e.payTogether(...a)),class:"bg-green-500 text-white py-2 px-4 rounded hover:bg-green-600"}," Pagar Todo ")])):T("",!0),o("div",qe,[o("h3",xe,"Total Final: $"+i(e.calculateTotalAll()),1)]),o("div",ze,[o("button",{onClick:t[3]||(t[3]=(...a)=>e.onSubmit&&e.onSubmit(...a)),class:"bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed"}," Guardar "),e.allPaid?(u(),d("button",{key:0,onClick:t[4]||(t[4]=(...a)=>e.fianlizateSubmit&&e.fianlizateSubmit(...a)),class:"ml-4 bg-red-500 text-white py-2 px-4 rounded hover:bg-red-600"}," Finalizar Venta ")):T("",!0)])]),o("div",Ge,[o("pre",Qe,"                "+i(JSON.stringify(e.values,null,2))+`
            `,1),o("pre",Me,"                "+i(JSON.stringify(e.errors,null,2))+`
            `,1),o("pre",Le,"                "+i(JSON.stringify(e.meta,null,2))+`
            `,1)])])}const Ye=ce(he,[["render",Je]]);export{Ye as default};
